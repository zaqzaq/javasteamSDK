
stages:
  - wake
  - build
  - wake
  - test
  - wake
  - publish

wake:
  stage: wake
  tags:
    - ubuntu
  script:
    - wakeonlan 10:9A:DD:51:F5:11
    - wakeonlan 70:85:C2:59:37:97
    - sleep 5s

buildWindows:
  stage: build
  tags:
    - windows
  script:
    - ./gradlew assemble
  artifacts:
    paths:
      - build/libs/*.jar
    expire_in: 1 week

buildLinux:
  stage: build
  tags:
    - ubuntu
  script:
    - ./gradlew assemble
  artifacts:
    paths:
      - build/libs/*.jar
    expire_in: 1 week

buildOsx:
  stage: build
  tags:
    - osx
  script:
    - ./gradlew assemble
  artifacts:
    paths:
      - build/libs/*.jar
    expire_in: 1 week

testWindows:
  stage: test
  tags:
    - windows
  script:
    - ./gradlew -i check

testLinux:
  stage: test
  tags:
    - ubuntu
  script:
    - ./gradlew -i check

testOsx:
  stage: test
  tags:
    - osx
  script:
    - ./gradlew -i check

publishWindows:
  stage: publish
  tags:
    - windows
  script:
    - ./gradlew distribute
    - ./gradlew publish

publishLinux:
  stage: publish
  tags:
    - ubuntu
  script:
    - ./gradlew distribute
    - ./gradlew publish

publishOsx:
  stage: publish
  tags:
    - osx
  script:
    - ./gradlew distribute
    - ./gradlew publish

after_script:
  - echo "End CI"
